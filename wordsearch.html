<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lang Land - Word Search</title>
<style>
body.pag-wordsearch {
    min-height: 100vh;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background: #16d6b7;
    display: flex;
    flex-direction: column;
}
.estrela-bg {
    position: absolute; top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none; z-index: 0; overflow: hidden;
}
.estrelinha {
    position: absolute;
    color: #edc945;
    opacity: 0.7;
    animation: estrelaMove 8s linear infinite;
}
@keyframes estrelaMove {
    0% { transform: translateY(-20px);}
    100% { transform: translateY(100vh);}
}
header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 15px 20px; background-color: #bfedfb;
    z-index: 2; position: relative;
}
.logo img { width: 145px; }
.perfil-icon { width: 70px; cursor: pointer; }
.centro-header {
    flex: 1;
    display: flex;
    justify-content: center;
}
h1 {
    color: #d91563;
    font-size: 2rem;
    margin: 0;
    text-align: center;
}
main {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 2;
    position: relative;
}
.game-container h2 {
    color: #ffffff;
    text-align: center;
    margin-bottom: 15px;
    font-weight: bold;
}
.wordsearch-grid {
    display: grid; gap: 6px; margin-top: 20px; user-select: none;
}
.cell {
    width: 50px; height: 50px;
    display: flex; align-items: center; justify-content: center;
    background-color: #bfedfb; border-radius: 5px;
    font-weight: bold; font-size: 1.2rem;
    cursor: pointer; transition: background 0.2s;
}
.cell.selected { background-color: #e84251; color: white; }
.cell.found { background-color: #16d6b7; color: #fff; }
.word-list {
    margin-top: 20px; display: flex; flex-wrap: wrap;
    justify-content: center; gap: 15px;
    padding-bottom: 60px;
}
.word-item {
    background-color: #247bca; color: white;
    padding: 6px 12px; border-radius: 8px; font-weight: bold;
}
button {
    margin-top: 20px; padding: 10px 16px;
    border: none; border-radius: 8px;
    background-color: #247bca; color: white;
    font-size: 1rem; cursor: pointer;
    transition: background 0.2s, transform 0.2s;
}
button:hover { background-color: #e84251; transform: scale(1.05); }
footer {
    text-align: center;
    padding: 15px;
    font-size: 14px;
    color: #fff;
    background: #247bca;
    margin-top: auto;
    cursor: pointer;
}
.game-container {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    width: 100%;
}
.level-selection {
    display: flex;
    gap: 20px;
    margin-top: 30px;
    flex-wrap: wrap;
    justify-content: center;
}
.level-card {
    background: #fff;
    padding: 25px 30px;
    border-radius: 15px;
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    cursor: pointer;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
    width: 140px;
}
.level-card:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 12px 20px rgba(0,0,0,0.3);
    background-color: #edc945;
    color: #d91563;
}
.level-card h3 {
    margin: 0;
    font-size: 1.4rem;
    color: #d91563;
}
.level-card p {
    margin: 5px 0 0;
    font-weight: bold;
    color: #247bca;
}
@media (max-width: 600px) {
    .wordsearch-grid { grid-template-columns: repeat(6, 40px); }
    .cell { width: 35px; height: 35px; font-size: 1rem; }
}
</style>
</head>
<body class="pag-wordsearch">
<div class="estrela-bg" id="estrela-bg"></div>
<header>
    <div class="logo">
        <img src="img/LOGOdeitada.png" alt="Lang Land Logo" style="cursor:pointer;" onclick="window.location.href='jogos.html'"> 
    </div>
    <div class="centro-header">
        <h1>Word Search</h1>
    </div>
    <div class="icones-conta">
         <a href="conta.html">
            <img src="img/Contapessoal.png" class="perfil-icon" alt="Perfil"> 
        </a>
    </div>
</header>
<main>
    <div class="game-container" id="menu">
        <h2>Escolha o nível</h2>
        <div class="level-selection">
            <div class="level-card" onclick="startGame('facil')">
                <h3>Fácil</h3>
                <p>5 palavras</p>
            </div>
            <div class="level-card" onclick="startGame('medio')">
                <h3>Médio</h3>
                <p>7 palavras</p>
            </div>
            <div class="level-card" onclick="startGame('dificil')">
                <h3>Difícil</h3>
                <p>9 palavras</p>
            </div>
        </div>
    </div>

    <div class="game-container" id="jogo" style="display:none;">
        <div id="grid" class="wordsearch-grid"></div>
        <div class="word-list" id="word-list"></div>
        <button onclick="backToMenu()">Voltar</button>
    </div>
</main>

<footer id="footer-link">
    &copy; 2025 Lang Land. Todos os direitos reservados.
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Verifica cadastro
    if(localStorage.getItem('usuarioCadastrado') !== 'true') {
        alert('Você precisa fazer o cadastro para acessar os jogos.');
        window.location.href = 'index.html';
    }

    // Estrelinhas de fundo
    const estrelaBg = document.getElementById('estrela-bg');
    for(let i=0; i<22; i++) {
        const estrela = document.createElement('span');
        estrela.className = 'estrelinha';
        estrela.innerHTML = '★';
        estrela.style.left = Math.random()*100 + 'vw';
        estrela.style.top = (-30 - Math.random()*60) + 'px';
        estrela.style.fontSize = (18 + Math.random()*22) + 'px';
        estrela.style.opacity = (0.5 + Math.random()*0.5);
        estrela.style.animationDuration = (6 + Math.random()*4) + 's';
        estrela.style.animationDelay = (Math.random()*8) + 's';
        estrelaBg.appendChild(estrela);
    }

    // Footer clicável
    const footerLink = document.getElementById("footer-link");
    footerLink.addEventListener("click", function() {
        window.location.href = "privacidade.html";
    });
});

// ---------------- JOGO ----------------
const levels = {
    facil: [
        ["CAT","DOG","SUN","MOON","BIRD"],
        ["APPLE","CAR","BALL","TREE","DUCK"],
        ["HOUSE","STAR","TOY","MILK","CHAIR"]
    ],
    medio: [
        ["APPLE","HOUSE","TRAIN","FISH","TREE","BALL","STAR"],
        ["HORSE","PLANE","SCHOOL","MUSIC","SHOE","FORK","CLOUD"],
        ["BREAD","CANDY","PHONE","LIGHT","SNAKE","WATER","DANCE"]
    ],
    dificil: [
        ["ELEPHANT","BUTTERFLY","COMPUTER","RAINBOW","PENCIL","DOLPHIN","GIRAFFE","FLOWER","CAR"],
        ["ALLIGATOR","MICROSCOPE","SPACESHIP","TELEPHONE","NOTEBOOK","UMBRELLA","BICYCLE","MARKER","LION"],
        ["KANGAROO","ASTRONAUT","VOLCANO","CHOCOLATE","ELECTRIC","PYRAMID","MOUNTAIN","OCEAN","PLANET"]
    ]
};

let currentLevel = null;
let currentRound = 0;
let selectedCells = [];
let foundWords = [];
let wordListContainer;

function startGame(level) {
    currentLevel = level;
    currentRound = 0;
    document.getElementById("menu").style.display = "none";
    document.getElementById("jogo").style.display = "flex";
    startRound();
}

// helpers para múltiplas palavras por célula
function addWordToCell(cell, word) {
    const arr = cell.dataset.words ? cell.dataset.words.split('|') : [];
    if (!arr.includes(word)) {
        arr.push(word);
        cell.dataset.words = arr.join('|');
    }
}
function cellHasWord(cell, word) {
    return cell.dataset.words && cell.dataset.words.split('|').includes(word);
}

function canPlaceWord(word, row, col, direction, gridSize, cells) {
    if (direction === 'H' && col + word.length <= gridSize) {
        for (let i = 0; i < word.length; i++) {
            const idx = row * gridSize + (col + i);
            const ch = cells[idx].textContent;
            if (ch !== '' && ch !== word[i]) {
                return false;
            }
        }
        return true;
    } else if (direction === 'V' && row + word.length <= gridSize) {
        for (let i = 0; i < word.length; i++) {
            const idx = (row + i) * gridSize + col;
            const ch = cells[idx].textContent;
            if (ch !== '' && ch !== word[i]) {
                return false;
            }
        }
        return true;
    }
    return false;
}

function placeWord(word, gridSize, cells) {
    let placed = false, attempts = 0;
    while (!placed && attempts < 2000) {
        const direction = Math.random() < 0.5 ? 'H' : 'V';
        const row = Math.floor(Math.random() * gridSize);
        const col = Math.floor(Math.random() * gridSize);
        if (canPlaceWord(word, row, col, direction, gridSize, cells)) {
            for (let i = 0; i < word.length; i++) {
                const idx = direction === 'H' ? row * gridSize + (col + i) : (row + i) * gridSize + col;
                cells[idx].textContent = word[i];
                addWordToCell(cells[idx], word);
            }
            placed = true;
        }
        attempts++;
    }
    return placed;
}

function startRound() {
    const grid = document.getElementById('grid');
    wordListContainer = document.getElementById('word-list');
    const words = levels[currentLevel][currentRound];
    grid.innerHTML = '';
    wordListContainer.innerHTML = '';
    selectedCells = [];
    foundWords = [];

    let maxWordLength = Math.max(...words.map(w => w.length));
    const totalLetters = words.reduce((s,w) => s + w.length, 0);
    // Tamanho maior quando muitas palavras grandes
    let gridSize = Math.max(12, maxWordLength + 4, Math.ceil(Math.sqrt(totalLetters * 1.5)));

    grid.style.gridTemplateColumns = `repeat(${gridSize}, 50px)`;

    let cells = [];
    for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.row = r;
            cell.dataset.col = c;
            cell.textContent = '';
            grid.appendChild(cell);
            cells.push(cell);
        }
    }

    // Coloca palavras maiores primeiro (melhora encaixe)
    const placeOrder = [...words].sort((a,b) => b.length - a.length);
    placeOrder.forEach(word => {
        const ok = placeWord(word, gridSize, cells);
        if (!ok) {
            // se não coube, tentamos mais uma vez (apenas logging console; não quebra a UI)
            console.warn('Não foi possível posicionar a palavra:', word);
        }
    });

    // Preenche espaços vazios com letras aleatórias
    cells.forEach(cell => {
        if (cell.textContent === '') {
            cell.textContent = String.fromCharCode(65 + Math.floor(Math.random() * 26));
        }
    });

    // Lista de palavras (ordem original)
    words.forEach(w => {
        const span = document.createElement('span');
        span.className = 'word-item';
        span.textContent = w;
        wordListContainer.appendChild(span);
    });

    // Seleção: permitimos clicar mesmo em células já encontradas (para cruzamentos)
    cells.forEach(cell => {
        cell.addEventListener('click', () => {
            // toggle seleção (permitido mesmo se já tem 'found')
            cell.classList.toggle('selected');
            if (cell.classList.contains('selected')) {
                selectedCells.push(cell);
            } else {
                selectedCells = selectedCells.filter(c => c !== cell);
            }

            checkSelectedWord(words);
        });
    });
}

function checkSelectedWord(words) {
    if (selectedCells.length < 2) return;

    // Verifica orientação (linha ou coluna)
    const rows = selectedCells.map(c => Number(c.dataset.row));
    const cols = selectedCells.map(c => Number(c.dataset.col));
    const allSameRow = rows.every(r => r === rows[0]);
    const allSameCol = cols.every(c => c === cols[0]);
    if (!allSameRow && !allSameCol) {
        return; // seleção inválida (não em linha/coluna)
    }

    // Ordena corretamente
    if (allSameRow) {
        selectedCells.sort((a, b) => Number(a.dataset.col) - Number(b.dataset.col));
    } else {
        selectedCells.sort((a, b) => Number(a.dataset.row) - Number(b.dataset.row));
    }

    // Verifica que são consecutivas
    for (let i = 1; i < selectedCells.length; i++) {
        if (allSameRow) {
            if (Number(selectedCells[i].dataset.col) - Number(selectedCells[i - 1].dataset.col) !== 1) return;
        } else {
            if (Number(selectedCells[i].dataset.row) - Number(selectedCells[i - 1].dataset.row) !== 1) return;
        }
    }

    const forward = selectedCells.map(c => c.textContent).join('');
    const backward = selectedCells.map(c => c.textContent).reverse().join('');

    for (const word of words) {
        if (foundWords.includes(word)) continue;

        if (forward === word || backward === word) {
            // garante que cada célula selecionada faz parte daquela palavra (colisão correta)
            const allCellsHaveWord = selectedCells.every(c => cellHasWord(c, word));
            if (!allCellsHaveWord) continue;

            // marca encontrada
            foundWords.push(word);
            Array.from(wordListContainer.children).forEach(span => {
                if (span.textContent === word) {
                    span.style.backgroundColor = '#16d6b7';
                    span.style.color = '#d91563';
                }
            });

            selectedCells.forEach(c => {
                c.classList.remove('selected');
                c.classList.add('found');
            });
            selectedCells = [];
            break;
        }
    }

    if (foundWords.length === words.length) {
        if (currentRound + 1 < levels[currentLevel].length) {
            alert('Rodada concluída! Próxima!');
            currentRound++;
            startRound();
        } else {
            alert('Você concluiu o nível!');
            backToMenu();
        }
    }
}

function backToMenu(){
    document.getElementById("jogo").style.display="none";
    document.getElementById("menu").style.display="flex";
}
</script>
</body>
</html>



